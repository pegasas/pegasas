# MySQL语句执行步骤

![mysql-execute.png](./mysql-execute.png)

连接器（即架构图中连接池）
负责客户端与服务端进行连接的工作。

## 查询缓存

MySQL收到一个查询请求后，会先到查询缓存里检查一下，之前是不是执行过这条语句。
注意：
MySQL8.0 已经移除了查询缓存功能。

## 词法分析器

查询缓存没有命中的话，就会开始真正执行SQL语句了。也就是第三步：词法分析器。
SQL经过分析器分析以后会生成类似如下的一个语法树：

![sql-tree.png](./sql-tree.png)

至此分析器的工作任务也基本完成了，接下来进入到优化器。

## 优化器

SQL语句经过分析器分析后，在开始执行之前，还要先经过优化器的处理。
优化器是在表里面有多个索引的时候，决定使用哪个索引；
或者在一个语句有多表关联（join）的时候，决定各个表的连接顺序；
以及一些mysql自己内部的优化机制。
最终 优化器会选择一个最优的查询路径。

## 执行器

这里面包含两步：

### 发送

把查询优化器选择的结果作为任务发送给底层的存储引擎去真正的执行。
我们的数据放在内存或者磁盘，存储引擎其实就是执行 sql 语句的，他会按照一定的步骤查询内存缓存数据，更新磁盘数据等。
也就是说 索引什么的都是存储引擎这里用的。

### 接收
不断接收 存储引擎已经执行过的语句的结果，返回给相应的任务（即对应的查询请求任务）。
由 MySql 语句执行步骤可知存储引擎至关重要。